# MAPLE
A robust computational framework for methylation age and disease-risk prediction based on pairwise learning

## Overview

Conventional epigenetic clocks encounter challenges in generalizability, especially when there exist significant batch effects between the training and test datasets, restricting their clinical applicability for aging assessment. Here, we present MAPLE, a robust computational framework for Methylation Age and disease-risk prediction through Pairwise LEarning. MAPLE utilizes pairwise learning to discern the relative relationships between two DNA methylation profiles regarding age or disease risk. It effectively identifies aging- or disease-related biological signals while mitigating technical biases in the data. MAPLE outperforms five competing methods, achieving a median absolute error of 1.6 years across 31 benchmark tests from diverse studies, sequencing platforms, data preprocessing methods, and tissue types. Furthermore, MAPLE excels in assessing aging-related disease risk, with mean AUCs of 0.96 for disease identification and 0.83 for pre-disease status detection. In conclusion, MAPLE represents a reliable tool with great potential for accessing epigenetic age and aging-related disease risk clinically.

## Tutorial

### Download this repository

```
git clone https://github.com/Drizzle-Zhang/MAPLE.git
```

Download model parameters into "checkpoints" folder (Google Drive: https://drive.google.com/file/d/1Qyv6yvj2seBarpMudK8O9xGqEZja6Wkt/view?usp=sharing), and then decompress this tar file.

### Inference

Arguments list

| Argument     | Description                                                  |
| ------------ | ------------------------------------------------------------ |
| input_format | The file format of DNA methylation data input into MAPLE. (idat or beta_value) |
| input_path   | The path of DNA methylation data.                            |
| sample_info  | The csv file including sample infomation                     |
| output_path  | The output file generated by MAPLE                           |

If you choose to use "idat" files as input, place the files in the "input_path" directory and name them according to the sample names listed in the "sample_info" file. Then, proceed to run the MAPLE inference as follows:

```
python MAPLE_inference.py --input_format idat --input_path ./examples/input_data --sample_info ./examples/test_meta.csv --output_path ./examples/MAPLE_output.csv
```

If you choose to use a "beta_value" file as input, place the matrix file in the "input_path" directory and name it "Beta_values.csv". The columns of the CSV file should correspond to CpG sites, while the rows should represent sample names. Subsequently, proceed to run the MAPLE inference as follows:

```
python MAPLE_inference.py --input_format beta_value --input_path ./examples/input_data --sample_info ./examples/test_meta.csv --output_path ./examples/MAPLE_output.csv
```
